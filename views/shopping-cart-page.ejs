<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Shopping Cart</title>

        <!-- CSS -->
        <link rel="stylesheet" href="/css/reset.css" />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
            crossorigin="anonymous"
        />
        <link rel="stylesheet" href="/css/cart.css"/>

        <!-- Favicon -->
        <link
            rel="apple-touch-icon"
            sizes="57x57"
            href="/favicon/apple-icon-57x57.png"
        />
        <link
            rel="apple-touch-icon"
            sizes="60x60"
            href="/favicon/apple-icon-60x60.png"
        />
        <link
            rel="apple-touch-icon"
            sizes="72x72"
            href="/favicon/apple-icon-72x72.png"
        />
        <link
            rel="apple-touch-icon"
            sizes="76x76"
            href="/favicon/apple-icon-76x76.png"
        />
        <link
            rel="apple-touch-icon"
            sizes="114x114"
            href="/favicon/apple-icon-114x114.png"
        />
        <link
            rel="apple-touch-icon"
            sizes="120x120"
            href="/favicon/apple-icon-120x120.png"
        />
        <link
            rel="apple-touch-icon"
            sizes="144x144"
            href="/favicon/apple-icon-144x144.png"
        />
        <link
            rel="apple-touch-icon"
            sizes="152x152"
            href="/favicon/apple-icon-152x152.png"
        />
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/favicon/apple-icon-180x180.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="192x192"
            href="/favicon/android-icon-192x192.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/favicon/favicon-32x32.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="96x96"
            href="/favicon/favicon-96x96.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="/favicon/favicon-16x16.png"
        />
        <link rel="manifest" href="/favicon/manifest.json" />
        <meta name="msapplication-TileColor" content="#ffffff" />
        <meta
            name="msapplication-TileImage"
            content="/favicon/ms-icon-144x144.png"
        />
        <meta name="theme-color" content="#ffffff" />

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@400;500;600;700&family=Roboto+Serif:opsz,wght@8..144,400;8..144,500;8..144,600&display=swap"
            rel="stylesheet"
        />

        <!-- Font Awesome 5 -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
    </head>
    <body>
      <%- include('partials/nav-customer')%>
        <!-- main -->
        <section class="v" style="background-color: rgb(246, 135, 19,0.5);">
          <div class="container py-4">
            <div class="row d-flex justify-content-center align-items-center ">
              <div class="col">
                <p><span class="h2">Shopping Cart </span></p>
                <!-- order -->
                <div class="" role="document" style="background-color: white; padding: 10px; border-radius: 10px;">
                  <div class="modal-content">
                    <div class="modal-header" >
                        <h5 class="modal-title" id="exampleModalLongTitle" >
                            Order Details
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <!-- order form -->
                  <form action="/shipper/homepage" id="form-order" method="POST">    
                    <div class="modal-body">
                          <div class="row">
                              <div class="col mb-1">
                                  <p class="small mb-1">Distribution Hub</p>
                                  <p>Tan Son Nhat Cargo Terminal</p>
                                  <input type="hidden" id="distributionHub" name="distributionHub" value="Tan Son Nhat Cargo Terminal">
                              </div>
                              <div class="col mb-1">
                                  <p class="small mb-1">Date</p>
                                  <input type="date" name="date">
                              </div>
                          </div>
                          <div class="row">
                              <div class="col">
                                  <input type="hidden" value="Active" name="status">
                              </div>    
                          </div>
                        <hr>
                        <p class="small mb-1">Item list</p>
                        <input type="hidden" name="products" value="<%= JSON.stringify(cart.products.map(product => product.name)) %>">
                          <%if(cart.products.length > 0) { %>
                            <% cart.products.forEach((product) => {  %>
                              <div class="list-item-<%=product.id%> row">
                                <div class="col">
                                    <p><%=product.name%></p>
                                </div>
                                <div class="col d-flex align-items-center justify-content-between">
                                    <p class="mb-0 me-3"><%=product.price%> $</p>
                                    <button type="button" onclick="event.preventDefault(); deleteProduct('<%= product.id %>')" class="btn btn-danger"><i class="fa-solid fa-x"></i></button>  
                                </div>
                              </div>
                            <% }); %>
                          <% } else { %>
                              <div></div>
                          <% }; %>
                        <hr>
                        <div class="row">
                          <div class="col">
                            <p>Total Price</p>
                          </div>
                          <div class="col ">
                            <p><%=Math.round(cart.totalPrice)%> $</p>
                          </div>
                        </div>
                        <div class="row">
                            <div class="col mb-1">
                                <p class="small mb-1">Receiver</p>
                                <input type="text" name="receiver" placeholder="name...">
                            </div>
                            <div class="col mb-1">
                                <p class="small mb-1">Address</p>
                                <input type="text" name="address" placeholder="123 Le Van Luong...">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col mb-1">
                                <p class="small mb-1">Phone Number</p>
                                <input type="text" placeholder="0901234568">
                            </div>
                            <div class="col mb-1">
                              <label class="small mb-1" for="payment">Payment Method</label>
                              <div></div>
                              <select class="custom-select my-1 mr-sm-2" name="payment" id="payment">
                                  <option value="Cash on Delivery (COD)" selected>Cash on Delivery (COD)</option>
                                  <option value="Internet Banking">Internet Banking</option>
                              </select> 
                            </div>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button type="submit" class="btn btn-danger">Order</button>
                      </div>
                    </form>  
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <!-- footer -->
        <%- include ('partials/footer-customer')%>
        <!-- JavaScript -->
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
            crossorigin="anonymous"
        ></script>
        <script>
          function deleteProduct(productId) {
                // Create a hidden input field for the product ID
                const productIdInput = document.createElement('input');
                productIdInput.type = 'hidden';
                productIdInput.name = 'productId';
                productIdInput.value = productId;

                // Append the input field to the form
                const form = document.querySelector('form');
                form.appendChild(productIdInput);

                // Send an AJAX request to delete the product
                const xhr = new XMLHttpRequest();
                xhr.open('POST', '/deleteProduct', true);
                xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                xhr.onreadystatechange = function () {
                  if (xhr.readyState === 4 && xhr.status === 200) {
                    // Handle the success response
                    console.log('Product deleted successfully.');
                    
                    // Remove the product element from the UI
                    const productElement = document.querySelector(`.modal-body .list-item-${productId}`);
                    if (productElement) {
                      productElement.parentNode.removeChild(productElement);
                    }
                  } else if (xhr.readyState === 4 && xhr.status !== 200) {
                    // Handle the error response
                    console.log('Error deleting product.');
                  }
                };
                xhr.send(`id=${productId}`);
              }
        </script>
        <script src="/js/shopping-cart.js"></script>
    </body>
</html>